
<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>ØªØ·Ø¨ÙŠÙ‚ Ø³Ù†ØªÙˆØ±ÙŠÙ†ÙŠ Ø´Ø§Ù„ÙŠÙ‡</title>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" rel="stylesheet"/>
<link href="manifest.json" rel="manifest"/>
<meta content="#007bff" name="theme-color"/>
<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
    html, body {
      font-family: 'Tajawal', sans-serif;
      background: #ffffff;
      margin: 0; padding: 0; height: 100%; overflow-x: hidden; color: #333;
    }
    .swiper { width: 100vw; height: 100vh; }
    .swiper-slide {
      width: 80%; max-width: 420px;
      opacity: 0.3; transform: scale(0.9);
      transition: all 0.4s ease;
      box-sizing: border-box;
      padding: 10px;
    }
    .swiper-slide-active {
      opacity: 1; transform: scale(1);
      z-index: 10;
    }
    .month-title {
      font-size: 22px; font-weight: 700; margin: 12px 0 8px;
      color: #024488; text-align: center; width: 100%; display: block;
    }
    .weekday-row {
      display: grid; grid-template-columns: repeat(7, 1fr);
      width: 100%; font-size: 13px; text-align: center;
      color: #666; margin-bottom: 5px;
    }
    .calendar-grid {
      display: grid; grid-template-columns: repeat(7, 1fr);
      gap: 6px; width: 100%;
    }
    .day {
      padding: 6px 0 24px; text-align: center;
      background: #f0f0f0; border-radius: 10px;
      cursor: pointer; font-size: 15px;
      position: relative; overflow: visible;
      transition: background 0.2s ease;
      user-select: none;
    }
.day.empty {
  background: #eaeaea;   /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ ÙˆØ§Ø¶Ø­ */
  border-radius: 10px;
  cursor: default;
  box-shadow: none;
  opacity: 0.6;
  color: transparent;   /* Ø¥Ø®ÙØ§Ø¡ Ø£ÙŠ Ù†Øµ Ø¯Ø§Ø®Ù„ÙŠ */
  border: 1px solid #ddd;
}



    .day-number {
      font-size: 15px; font-weight: normal;
    }
    .booking-line {
      font-size: 12px; margin-top: 2px;
      color: #444; user-select: none;
      text-align: center;
      font-weight: bold;
    }
    .booking-line.red { color: #b22222; } /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ø¯Ø§ÙƒÙ† */
    .booking-line.orange { color: #007bff; }
    .day.today {
      border: 2px solid #007bff;
      font-weight: bold; background: #e6f0ff;
      color: #007bff;
    }
    .day:hover { background: #ddd; }

    /* Popup styles */
    .popup {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #fff; padding: 20px 25px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.15);
      z-index: 9999; display: none;
      width: 90%; max-width: 420px;
      color: #333; box-sizing: border-box;
      max-height: 90vh;
      overflow-y: auto;
    }
    .popup h3 {
      margin-top: 0; font-size: 20px; color: #007bff;
      text-align: center;
    }
    .popup label {
      font-weight: 600; margin-top: 12px;
      display: block; color: #444;
    }
    .popup input[type=text],
    .popup input[type=number],
    .popup textarea,
    .popup select {
      padding: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-family: 'Tajawal', sans-serif;
      font-size: 14px;
      width: 100%;
      display: block;
      margin-top: 4px;
    }
    input[type=checkbox] {
      transform: scale(1.3);
      margin-left: 8px;
      vertical-align: middle;
      cursor: pointer;
    }
    .popup button.action {
      background: #28a745;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      transition: background-color 0.3s ease;
    }
    .popup button.action:hover {
      background: #218838;
    }
    .popup .close-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: none;
      border: none;
      font-size: 30px;
      color: #888;
      cursor: pointer;
      padding: 0;
      line-height: 1;
      width: 30px;
      height: 30px;
      text-align: center;
    }
    .close-btn:hover {
      color: #333;
    }

    /* ØªØ¹Ø¯ÙŠÙ„ Ø²Ø± Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø² Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø¶Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .button-group {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 20px;
    }

    .button-group .action {
      flex: 1;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      cursor: pointer;
      border: none;
      color: white;
      transition: background-color 0.3s ease;
    }

    .button-group .action.secondary {
      background-color: #007bff;
    }

    .button-group .action.secondary:hover {
      background-color: #0056b3;
    }

    .button-group .action:hover {
      background-color: #218838;
    }

    /* Ø²Ø± Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø² Ù…Ø®ÙÙŠ Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ */
    #showBookingCard {
      display: none;
    }

    #goToToday {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 50px;
      font-size: 14px;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .month-buttons {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 20px;
    }

    .month-buttons button {
      background-color: #024488;
      color: white;
      padding: 10px 18px;
      font-size: 15px;
      border: none;
      border-radius: 12px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .month-buttons button:hover {
      transform: scale(1.05);
    }

    /* Expenses list */
    #expenseList {
      margin-top: 12px;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      font-size: 14px;
      background: #fafafa;
    }
    #expenseList div {
      margin-bottom: 6px;
      padding-bottom: 4px;
      border-bottom: 1px solid #ddd;
    }
    .logo-container {
      text-align: center;
      margin: 20px 0;
    }

    .logo-container img {
      width: 160px;
      max-width: 90%;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      transition: transform 0.3s ease;
    }

    .logo-container img:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }
#bookingCardPopup img {
  max-width: 100%;
  width: 120px;
  display: block;
  margin: 0 auto;
}

  
.property-switch {
  display: flex; gap: 10px; justify-content: center;
  padding: 8px 12px; border-bottom: 1px solid #eee;
}
.prop-btn {
  background: #eef4ff; color: #024488; border: 1px solid #d7e3ff;
  padding: 8px 14px; border-radius: 20px; cursor: pointer; font-weight: 700;
}
.prop-btn.active { background: #024488; color: #fff; border-color: #024488; }
</style>
</head>
<body>
<div id="notifications" style="
  position: fixed;
  top: 10px;
  right: 10px;
  background: #ffeaa7;
  color: #2d3436;
  padding: 10px 20px;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
  display: none;
  z-index: 1000;
"></div>
<div class="popup" id="dashboardPopup" style="max-width:600px;">
<button class="close-btn" onclick="closePopup('dashboardPopup')">Ã—</button>
<h3 style="color:#007bff;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
<div id="dashboardContent" style="text-align:center;"></div>
</div>
<div class="property-switch" id="propertySwitch"><button class="prop-btn active" onclick="switchProperty('chalet')">ğŸ– Ø§Ù„Ø´Ø§Ù„ÙŠÙ‡</button><button class="prop-btn" onclick="switchProperty('apartment')">ğŸ¢ Ø§Ù„Ø´Ù‚Ø©</button></div><div class="logo-container">
<img id="mainLogo" src="https://i.ibb.co/271BVWXd/Santorini-Logo.png" alt="Santorini-Logo" border="0">
</div>
<div class="swiper">
<div class="swiper-wrapper" id="monthsContainer"></div>
</div>
<button id="goToToday">Ø§Ù„ÙŠÙˆÙ…</button>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø¬Ø² -->
<div class="popup" id="bookingPopup">
<button class="close-btn" onclick="closePopup('bookingPopup')">Ã—</button>
<h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²</h3>
<label for="periodSelect">Ø§Ù„ÙØªØ±Ø©:</label>
<select id="periodSelect">
<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø©</option>
<option value="morning">ØµØ¨Ø§Ø­</option>
<option value="evening">Ù…Ø³Ø§Ø¡</option>
<option value="fullDay">ÙŠÙˆÙ… ÙƒØ§Ù…Ù„</option>
<option value="overnight">Ù…Ø¨ÙŠØª</option>
</select>
<label for="timePeriod" id="timePeriodLabel" style="display:none;">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</label>
<input id="timePeriod" placeholder="Ù…Ø«Ø§Ù„: 8-12 Øµ Ø£Ùˆ 4-8 Ù…" style="display:none;" type="text"/>
<label for="status">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø²:</label>
<select id="status">
<option value="">Ø§Ø®ØªØ±</option>
<option value="Ù…Ø­Ø¬ÙˆØ²">Ù…Ø­Ø¬ÙˆØ²</option>
<option value="Ø¹Ø±Ø¨ÙˆÙ†">Ø¹Ø±Ø¨ÙˆÙ†</option>
<option value="Ù…ØªØ§Ø­">Ù…ØªØ§Ø­</option>
</select>
<label for="amount">Ø§Ù„Ø³Ø¹Ø±:</label>
<input id="amount" placeholder="Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ" type="number"/>
<div class="deposit-group" id="depositGroup" style="display:none;">
<label for="deposit" style="font-weight: bold; color: #c00;">Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†:</label>
<input id="deposit" placeholder="Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ" style="width: 80px; margin-left: 6px;" type="number"/>
<span id="remaining" style="margin-left: 10px; font-weight: bold;"></span>
</div>
<label for="guestCount">Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ÙŠÙˆÙ:</label>
<input id="guestCount" min="1" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ÙŠÙˆÙ" type="number"/>
<hr style="margin: 20px 0;"/>
<label for="guestName">Ø§Ø³Ù… Ø§Ù„Ø¶ÙŠÙ:</label>
<input id="guestName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¶ÙŠÙ" type="text"/>
<label for="guestPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
<input id="guestPhone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" type="text"/>
<label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
<textarea id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©" rows="2"></textarea>
<div class="button-group">
<button class="action" id="saveBooking">ğŸ’¾ Ø­ÙØ¸</button>
<button class="action secondary" id="showBookingCard">ğŸƒ Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø²</button>
<div id="copyReservationLink" style="display:none; margin-top:10px; cursor:pointer; color:#007bff;">
ğŸ“‹ Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø¬Ø²
  </div>
</div>
</div>
<!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø² -->
<div class="popup" id="bookingCardPopup" style="max-width: 350px;">
<button class="close-btn" onclick="closePopup('bookingCardPopup')">Ã—</button>
<img id="cardLogo" src="https://i.ibb.co/271BVWXd/Santorini-Logo.png" alt="Santorini-Logo" border="0">
<h3 style="text-align:center;">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø²</h3>
<div id="bookingCardContent" style="font-size: 14px; line-height: 1.4; direction: rtl;"></div>
</div>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
<div class="popup" id="expensesPopup" style="max-width: 350px;">
<button class="close-btn" onclick="closePopup('expensesPopup')">Ã—</button>
<h3>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
<label for="expenseTypeSelect">Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ:</label>
<select id="expenseTypeSelect" style="width: 100%; padding: 6px; font-size: 14px;">
<option disabled="" selected="" value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</option>
<option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
<option value="Ù…Ø§Ø¡">Ù…Ø§Ø¡</option>
<option value="Ø±ÙˆØ§ØªØ¨">Ø±ÙˆØ§ØªØ¨</option>
<option value="ØªÙ†Ø¸ÙŠÙ">ØªÙ†Ø¸ÙŠÙ</option>
<option value="Ø§Ù†ØªØ±Ù†Øª">Ø§Ù†ØªØ±Ù†Øª</option>
<option value="ØµÙŠØ§Ù†Ø©">ØµÙŠØ§Ù†Ø©</option>
<option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
</select>
<input id="expenseTypeInput" placeholder="Ø£Ø¯Ø®Ù„ Ù†ÙˆØ¹ Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯" style="margin-top: 10px; display:none; width: 100%; padding: 6px; font-size: 14px;" type="text"/>
<label for="expenseAmount">Ø§Ù„Ù…Ø¨Ù„Øº:</label>
<input id="expenseAmount" placeholder="Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ" type="number"/>
<div style="display: flex; justify-content: space-between; gap: 10px;">
<button class="action" id="saveExpense" style="width: 48%;">Ø­ÙØ¸</button>
<button class="action" id="deleteExpense" style="width: 48%; background: #dc3545;">Ø­Ø°Ù</button>
</div>
<div id="expenseList"></div>
</div>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
<div class="popup" id="reportPopup" style="max-width: 400px;">
<button class="close-btn" onclick="closePopup('reportPopup')">Ã—</button>
<h3>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù†Ø·Ø§Ù‚</h3>
<label for="reportFromDate">Ù…Ù†:</label>
<input id="reportFromDate" max="2025-12-31" type="date" value="2025-01-01"/>
<label for="reportToDate" style="margin-top: 12px;">Ø¥Ù„Ù‰:</label>
<input id="reportToDate" max="2025-12-31" type="date" value="2025-01-31"/>
<button class="action" id="generateReportBtn" style="width: 100%; margin-top: 15px;">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
<div id="reportContent" style="font-size: 14px; line-height: 1.5; min-height: 120px; margin-top: 12px;"></div>
</div>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').then(() => {
    console.log('Service Worker Registered');
  });
}
</script>
<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAs1Qz1_8Bge6LvIZ61CsjQV4P8RSa8t4A",
  authDomain: "santorini-chalet.firebaseapp.com",
  projectId: "santorini-chalet",
  storageBucket: "santorini-chalet.firebasestorage.app",
  messagingSenderId: "280049242908",
  appId: "1:280049242908:web:2e6e7d9d88506c764760d9",
  measurementId: "G-D8THYXGFSN"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

// ===== ØªØ¨Ø¯ÙŠÙ„ Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ù‚Ø§Ø± =====
const CHALET_LOGO = "https://i.ibb.co/271BVWXd/Santorini-Logo.png"; // Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø§Ù„ÙŠÙ‡ (Ø³Ù†ØªÙˆØ±ÙŠÙ†ÙŠ)
const APARTMENT_LOGO = "https://i.ibb.co/XxYxYMpC/Beige-and-Brown-Modern-Illustrative-Hotel-Resort-Logo.png"; // Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ù‚Ø©

// ØªÙØ¹ÙŠØ¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
function getLogoUrl() {
  return (currentProperty === 'chalet') ? CHALET_LOGO : APARTMENT_LOGO;
}

// ØªÙØ­Ø¯Ù‘ÙØ« ÙƒÙ„ Ø§Ù„Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©
function updateLogos() {
  const main = document.getElementById('mainLogo');
  if (main) main.src = getLogoUrl();

  const card = document.getElementById('cardLogo');
  if (card) card.src = getLogoUrl();
}

// ØªØ­Ø¯ÙŠØ« Ø£ÙˆÙ„ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', updateLogos);


async function loadMonthBookings(monthIndex) {
  const year = 2025;
  const monthStr = String(monthIndex + 1).padStart(2, '0');
  const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();

  const startKey = `${year}-${monthStr}-01`;
  const endKey   = `${year}-${monthStr}-${String(daysInMonth).padStart(2, '0')}`;

  const bookings = {};

  const snapshot = await db.collection(calendarCol())
    .where(firebase.firestore.FieldPath.documentId(), ">=", startKey)
    .where(firebase.firestore.FieldPath.documentId(), "<=", endKey)
    .get();

  snapshot.forEach(doc => {
    bookings[doc.id] = doc.data();
  });

  renderMonth(monthIndex, bookings);
}

    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
    let currentPeriod = null;
    let currentDateKey = null;
    let currentBookingData = null;
    let currentExpenseDocId = null;
    let expensesList = [];
    let expenseTypes = ['ÙƒÙ‡Ø±Ø¨Ø§Ø¡','Ù…Ø§Ø¡','Ø±ÙˆØ§ØªØ¨','ØªÙ†Ø¸ÙŠÙ','Ø§Ù†ØªØ±Ù†Øª','ØµÙŠØ§Ù†Ø©','Ø£Ø®Ø±Ù‰'];


    // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†
    function toggleDepositGroup(show) {
      const group = document.getElementById('depositGroup');
      group.style.display = show ? 'flex' : 'none';
      if (!show) {
        document.getElementById('deposit').value = '';
        document.getElementById('remaining').textContent = '';
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ø¹Ø±Ø¨ÙˆÙ†
    function updateRemaining() {
      const amount = parseFloat(document.getElementById('amount').value) || 0;
      const deposit = parseFloat(document.getElementById('deposit').value) || 0;
      const remaining = amount - deposit;
      document.getElementById('remaining').textContent = remaining > 0 ? `Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining}` : '';
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙÙŠ Ø§Ù„ÙŠÙˆÙ…
    function renderBookings(dayEl, data) {
      dayEl.querySelectorAll('.booking-line').forEach(el => el.remove());
      if (!data) return;

      ['morning', 'evening', 'fullDay', 'overnight'].forEach(period => {
        if (data[period] && data[period].status && data[period].status.trim() !== 'Ù…ØªØ§Ø­') {
          const div = document.createElement('div');
          div.className = 'booking-line ' + (data[period].status === 'Ù…Ø­Ø¬ÙˆØ²' ? 'red' : 'orange');
          let text = '';
          switch (period) {
case 'morning': text = data[period].timePeriod ? `${data[period].timePeriod}` : ''; break;
case 'evening': text = data[period].timePeriod ? `${data[period].timePeriod}` : ''; break;

            case 'fullDay': text = 'ÙƒØ§Ù…Ù„'; break;
            case 'overnight': text = 'Ù…Ø¨ÙŠØª'; break;
          }
          div.textContent = text;
          dayEl.appendChild(div);
        }
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
    function renderExpenses() {
      const expenseListDiv = document.getElementById('expenseList');
      expenseListDiv.innerHTML = '';
      let total = 0;

      expensesList.forEach(exp => {
        total += parseFloat(exp.amount);
        const div = document.createElement('div');
        div.textContent = `${exp.type} : ${exp.amount} Ø±.Ø¹`;
        expenseListDiv.appendChild(div);
      });

      // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
      const totalDiv = document.createElement('div');
      totalDiv.style.fontWeight = 'bold';
      totalDiv.style.marginTop = '10px';
      totalDiv.textContent = `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total.toFixed(2)} Ø±.Ø¹`;
      expenseListDiv.appendChild(totalDiv);
    }

    // Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙÙŠ ÙØ§ÙŠØ±Ø³ØªÙˆØ±
    function saveExpenses() {
      if (!currentExpenseDocId) return;
      db.collection("expenses").doc(currentExpenseDocId).set({ items: expensesList })
        .then(() => renderExpenses())
        .catch(e => alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ' + e.message));
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙˆÙ†ÙˆØ¹ÙŠØ§ØªÙ‡Ø§
async function loadExpenses(month) {
  currentExpenseDocId = expensesDocId(month);
  expensesList = [];
  document.getElementById('expenseList').innerHTML = '';
  document.getElementById('expenseTypeInput').style.display = 'none';
  document.getElementById('expenseTypeSelect').style.display = 'block';

  showPopup('expensesPopup'); // ğŸ‘ˆ Ø£Ø¶Ù Ù‡Ø°Ù‡ Ù‡Ù†Ø§
  const allTypes = [...new Set([...expenseTypes])];

  try {
    const doc = await db.collection("expenses").doc(currentExpenseDocId).get();
    if (doc.exists) {
      expensesList = doc.data().items || [];
      expensesList.forEach(exp => {
        if (!allTypes.includes(exp.type)) allTypes.push(exp.type);
      });
    }
  } catch(e) {
    alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ' + e.message);
  }

  const select = document.getElementById('expenseTypeSelect');
  select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</option>';
  allTypes.forEach(type => {
    const opt = document.createElement('option');
    opt.value = type;
    opt.textContent = type;
    select.appendChild(opt);
  });

  renderExpenses();
}


    // Ø­Ø¯Ø« ØªØºÙŠÙŠØ± Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ (Ø¥Ø¸Ù‡Ø§Ø± Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ø§Ø®ØªØ±Øª "Ø£Ø®Ø±Ù‰")
    document.getElementById('expenseTypeSelect').addEventListener('change', (e) => {
      if (e.target.value === 'Ø£Ø®Ø±Ù‰') {
        document.getElementById('expenseTypeInput').style.display = 'block';
        document.getElementById('expenseTypeInput').value = '';
        e.target.style.display = 'none';
      }
    });

document.getElementById('saveExpense').addEventListener('click', () => {
  let type = document.getElementById('expenseTypeSelect').value;
  if (!type) {
    type = document.getElementById('expenseTypeInput').value.trim();
    if (!type) {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ');
      return;
    }
  } else if (type === 'Ø£Ø®Ø±Ù‰') {
    // Ø®Ø° Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„ Ø¨Ø¯Ù„ "Ø£Ø®Ø±Ù‰"
    type = document.getElementById('expenseTypeInput').value.trim();
    if (!type) {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ');
      return;
    }
  }
  
  const amount = parseFloat(document.getElementById('expenseAmount').value);
  if (isNaN(amount) || amount <= 0) {
    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ§Ù„Ø­');
    return;
  }

  // ØªØ­Ø¯ÙŠØ« Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ±ÙˆÙ
  const existingIndex = expensesList.findIndex(exp => exp.type === type);
  if (existingIndex !== -1) {
    expensesList[existingIndex].amount += amount;
  } else {
    expensesList.push({ type, amount });
  }

  if (!expenseTypes.includes(type)) expenseTypes.push(type);

  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
  document.getElementById('expenseAmount').value = '';
  document.getElementById('expenseTypeInput').style.display = 'none';
  document.getElementById('expenseTypeInput').value = '';
  document.getElementById('expenseTypeSelect').style.display = 'block';
  document.getElementById('expenseTypeSelect').value = '';

  saveExpenses();
});

document.getElementById('deleteExpense').addEventListener('click', () => {
  let type = document.getElementById('expenseTypeSelect').value;
  
  if (!type || type === 'Ø£Ø®Ø±Ù‰') {
    type = document.getElementById('expenseTypeInput').value.trim();
    if (!type) {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ');
      return;
    }
  }

  const amount = parseFloat(document.getElementById('expenseAmount').value);
  if (isNaN(amount) || amount <= 0) {
    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ§Ù„Ø­');
    return;
  }

  const existingIndex = expensesList.findIndex(exp => exp.type === type);
  if (existingIndex !== -1) {
    expensesList[existingIndex].amount -= amount;
    if (expensesList[existingIndex].amount <= 0) {
      expensesList.splice(existingIndex, 1);
      const typeStillExists = expensesList.some(exp => exp.type === type);
      if (!typeStillExists) {
        expenseTypes = expenseTypes.filter(t => t !== type);
      }
    }
    saveExpenses();
  } else {
    alert('Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
  }

  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
  document.getElementById('expenseAmount').value = '';
  document.getElementById('expenseTypeInput').style.display = 'none';
  document.getElementById('expenseTypeInput').value = '';
  document.getElementById('expenseTypeSelect').style.display = 'block';
  document.getElementById('expenseTypeSelect').value = '';
});

    function closePopup(id) {
      document.getElementById(id).style.display = 'none';
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ø¹Ø±Ø¨ÙˆÙ†
    document.getElementById('amount').addEventListener('input', updateRemaining);
    document.getElementById('deposit').addEventListener('input', updateRemaining);

    // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø² (Ø¹Ø±Ø¶ Ø­Ù‚Ù„ Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ† Ø¥Ø°Ø§ Ø¹Ø±Ø¨ÙˆÙ†)
    document.getElementById('status').addEventListener('change', (e) => {
      toggleDepositGroup(e.target.value === 'Ø¹Ø±Ø¨ÙˆÙ†');
      if (e.target.value === 'Ù…ØªØ§Ø­') {
        document.getElementById('amount').value = '';
        document.getElementById('deposit').value = '';
        document.getElementById('remaining').textContent = '';
        document.getElementById('guestName').value = '';
        document.getElementById('guestPhone').value = '';
        document.getElementById('notes').value = '';
      }
    });

    // Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø©
    const periodSelect = document.getElementById('periodSelect');
    const timePeriodInput = document.getElementById('timePeriod');
    const timePeriodLabel = document.getElementById('timePeriodLabel');

    periodSelect.addEventListener('change', (e) => {
  if (typeof currentProperty !== 'undefined' && currentProperty === 'apartment') { e.target.value = 'fullDay'; currentPeriod = 'fullDay'; }
      currentPeriod = e.target.value;

      if (!currentPeriod) {
        clearBookingFields();
        return;
      }

      const periodData = (currentBookingData && currentBookingData[currentPeriod]) ? currentBookingData[currentPeriod] : null;

      if (!periodData) {
        clearBookingFields(false);
      } else {
        document.getElementById('status').value = periodData.status || '';
        document.getElementById('amount').value = periodData.amount || '';
        document.getElementById('deposit').value = periodData.deposit || '';
        updateRemaining();
        document.getElementById('guestCount').value = periodData.guestCount || '';
        document.getElementById('guestName').value = periodData.guestName || '';
        document.getElementById('guestPhone').value = periodData.guestPhone || '';
        document.getElementById('notes').value = periodData.notes || '';
      }

      if (currentPeriod === 'morning' || currentPeriod === 'evening') {
        timePeriodInput.value = periodData ? (periodData.timePeriod || '') : '';
        timePeriodInput.style.display = 'block';
        timePeriodLabel.style.display = 'block';
      } else {
        timePeriodInput.value = '';
        timePeriodInput.style.display = 'none';
        timePeriodLabel.style.display = 'none';
      }

      toggleDepositGroup(periodData && periodData.status === 'Ø¹Ø±Ø¨ÙˆÙ†');

      if (periodData && (periodData.status === 'Ù…Ø­Ø¬ÙˆØ²' || periodData.status === 'Ø¹Ø±Ø¨ÙˆÙ†')) {
        document.getElementById('showBookingCard').style.display = 'block';
      } else {
        document.getElementById('showBookingCard').style.display = 'none';
      }
    });

    function clearBookingFields(clearAll = true) {
      if (clearAll) {
        document.getElementById('status').value = '';
        document.getElementById('amount').value = '';
        document.getElementById('deposit').value = '';
        document.getElementById('remaining').textContent = '';
        document.getElementById('guestCount').value = '';
        document.getElementById('guestName').value = '';
        document.getElementById('guestPhone').value = '';
        document.getElementById('notes').value = '';
      }
      timePeriodInput.value = '';
      timePeriodInput.style.display = (currentPeriod === 'morning' || currentPeriod === 'evening') ? 'block' : 'none';
      timePeriodLabel.style.display = (currentPeriod === 'morning' || currentPeriod === 'evening') ? 'block' : 'none';
      toggleDepositGroup(false);
      document.getElementById('showBookingCard').style.display = 'none';
    }

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ÙŠÙˆÙ… ÙÙŠ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ù„ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø¬Ø²
    document.addEventListener('click', (e) => {
      const dayEl = e.target.classList.contains('day') ? e.target : e.target.closest('.day');
      if (!dayEl) return;

      currentDateKey = dayEl.getAttribute('data-date');
      currentBookingData = null;
      currentPeriod = null;

      showPopup('bookingPopup');
      document.getElementById('bookingPopup').setAttribute('data-date', currentDateKey);

      periodSelect.value = '';
      clearBookingFields();

      
  // Ø¶Ù…Ø§Ù† ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ Ù„Ù„Ø´Ù‚Ø© ÙˆØ¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙØªØ±Ø©
  try {
    if (typeof currentProperty !== 'undefined' && currentProperty === 'apartment') {
      const periodSelect = document.getElementById('periodSelect');
      const periodLabel = document.querySelector('label[for="periodSelect"]');
      const timePeriodInput = document.getElementById('timePeriod');
      const timePeriodLabel = document.getElementById('timePeriodLabel');
      if (periodSelect) {
        periodSelect.value = 'fullDay';
        periodSelect.disabled = true;
        currentPeriod = 'fullDay';
      }
      if (periodLabel) periodLabel.style.display = 'none';
      if (timePeriodInput) timePeriodInput.style.display = 'none';
      if (timePeriodLabel) timePeriodLabel.style.display = 'none';
    } else {
      const periodSelect = document.getElementById('periodSelect');
      const periodLabel = document.querySelector('label[for="periodSelect"]');
      if (periodSelect) periodSelect.disabled = false;
      if (periodLabel) periodLabel.style.display = '';
    }
  } catch(e) {}
// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø² Ù„Ù„ÙŠÙˆÙ… Ù…Ù† Firebase
     db.collection(calendarCol()).doc(currentDateKey).get().then(doc => {
        if (doc.exists) {
          currentBookingData = doc.data();
        } else {
          currentBookingData = {};
        }
      });
    });

    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø² ÙÙŠ Firestore
document.getElementById('saveBooking').addEventListener('click', async () => {
  if (typeof currentProperty !== 'undefined' && currentProperty === 'apartment') { currentPeriod = 'fullDay'; const ps=document.getElementById('periodSelect'); if (ps) ps.value='fullDay'; }
  if (!currentDateKey) {
    alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠÙˆÙ…!');
    return;
  }
  if (!currentPeriod) {
    alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø©!');
    return;
  }

  const status = document.getElementById('status').value;
  if (!status) {
    alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø²!');
    return;
  }

  if (status === 'Ù…ØªØ§Ø­') {
    const confirmDelete = confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©ØŸ');
    if (!confirmDelete) return;

    try {
      const docRef = db.collection(calendarCol()).doc(currentDateKey);
      // Ø§Ø­Ø°Ù Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
      await docRef.update({ [currentPeriod]: firebase.firestore.FieldValue.delete() });
      toast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­', 'success');
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
      const dayEl = document.querySelector(`.day[data-date='${currentDateKey}']`);
      const updatedDoc = await docRef.get();
      const newData = updatedDoc.exists ? updatedDoc.data() : {};
      if (dayEl) renderBookings(dayEl, newData);
      // Ø¥Ø®ÙØ§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø²
      document.getElementById('showBookingCard').style.display = 'none';
      currentBookingData = newData;
      closePopup('bookingPopup');
    } catch (e) {
      toast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²', 'error');
      console.error(e);
    }
    return;

    try {
      const docRef = db.collection(calendarCol()).doc(currentDateKey);

      await docRef.update({
        [currentPeriod]: firebase.firestore.FieldValue.delete()
      });

      alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­');
      currentBookingData = null;

      const dayEl = document.querySelector(`.day[data-date='${currentDateKey}']`);
      if (dayEl) renderBookings(dayEl, {});

      document.getElementById('showBookingCard').style.display = 'none';
      closePopup('bookingPopup');
    } catch (e) {
      alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²');
      console.error(e);
    }
    return;
  }

  // Ø¨Ø§Ù‚ÙŠ Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø¹Ø§Ø¯ÙŠ
  const amount = parseFloat(document.getElementById('amount').value) || 0;
  if ((status === 'Ù…Ø­Ø¬ÙˆØ²' || status === 'Ø¹Ø±Ø¨ÙˆÙ†') && amount <= 0) {
    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­!');
    return;
  }

  const periodData = {
  status,
  amount,
  deposit: status === 'Ø¹Ø±Ø¨ÙˆÙ†' ? (parseFloat(document.getElementById('deposit').value) || 0) : 0,
  guestName: document.getElementById('guestName').value.trim(),
  guestPhone: document.getElementById('guestPhone').value.trim(),
  guestCount: parseInt(document.getElementById('guestCount').value) || 0,
  notes: document.getElementById('notes').value.trim(),
  timePeriod: (currentPeriod === 'morning' || currentPeriod === 'evening') ? timePeriodInput.value.trim() : ''
};


  const updatedData = {...(currentBookingData || {})};
  updatedData[currentPeriod] = periodData;

  try {
    await db.collection(calendarCol()).doc(currentDateKey).set(updatedData);
const reservationLink = `https://santorinichalet.github.io/santorini-calendar/reservation.html?id=${currentDateKey}`;

const copyBtn = document.getElementById('copyReservationLink');
copyBtn.style.display = 'block';

copyBtn.onclick = () => {
  navigator.clipboard.writeText(reservationLink).then(() => {
    copyBtn.textContent = 'âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­';
    setTimeout(() => {
      copyBtn.innerHTML = 'ğŸ“‹ Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø¬Ø²';
    }, 3000);
  });
};

    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
    currentBookingData = updatedData;
    scheduleThankYou(updatedData);
    const dayEl = document.querySelector(`.day[data-date='${currentDateKey}']`);
    if (dayEl) renderBookings(dayEl, currentBookingData);

    document.getElementById('showBookingCard').style.display = 'block';
  } catch (e) {
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸');
    console.error(e);
  }
});


    // Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø²
    function showBookingCard() {
      if (!currentPeriod || !currentBookingData || !currentBookingData[currentPeriod]) return;

      const data = currentBookingData[currentPeriod];
      const cardContent = document.getElementById('bookingCardContent');
      const periodNames = {morning: 'ØµØ¨Ø§Ø­', evening: 'Ù…Ø³Ø§Ø¡', fullDay: 'ÙŠÙˆÙ… ÙƒØ§Ù…Ù„', overnight: 'Ù…Ø¨ÙŠØª'};

      cardContent.innerHTML = `
        <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø²:</strong> ${data.status}</p>
        <p><strong>Ø§Ù„ÙØªØ±Ø©:</strong> ${periodNames[currentPeriod]}</p>
        <p><strong>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</strong> ${data.timePeriod || 'Ù„Ø§ ØªÙˆØ¬Ø¯'}</p>
        <p><strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${data.amount} Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ</p>
        ${data.status === 'Ø¹Ø±Ø¨ÙˆÙ†' ? `<p><strong>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†:</strong> ${data.deposit} Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ</p>` : ''}
        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ÙŠÙˆÙ:</strong> ${data.guestCount || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
        <p><strong>Ø§Ø³Ù… Ø§Ù„Ø¶ÙŠÙ:</strong> ${data.guestName}</p>
        <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${data.guestPhone}</p>
        <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${data.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯'}</p>
      `;

      showPopup('bookingCardPopup');
    }

    // Ø²Ø± Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø²
    document.getElementById('showBookingCard').addEventListener('click', showBookingCard);

    // ØªÙ‡ÙŠØ¦Ø© swiper Ù„Ù„Ø£Ø´Ù‡Ø±
// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ… ÙÙŠ ÙƒÙ„ Ù…Ø±Ø© (Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±)
let swiper = null;

function buildCalendar() {
  const monthsList = [
    'ÙŠÙ†Ø§ÙŠØ± 2025','ÙØ¨Ø±Ø§ÙŠØ± 2025','Ù…Ø§Ø±Ø³ 2025','Ø£Ø¨Ø±ÙŠÙ„ 2025','Ù…Ø§ÙŠÙˆ 2025','ÙŠÙˆÙ†ÙŠÙˆ 2025',
    'ÙŠÙˆÙ„ÙŠÙˆ 2025','Ø£ØºØ³Ø·Ø³ 2025','Ø³Ø¨ØªÙ…Ø¨Ø± 2025','Ø£ÙƒØªÙˆØ¨Ø± 2025','Ù†ÙˆÙÙ…Ø¨Ø± 2025','Ø¯ÙŠØ³Ù…Ø¨Ø± 2025'
  ];
  const weekdays = ['Ø£Ø­Ø¯','Ø¥Ø«Ù†ÙŠÙ†','Ø«Ù„Ø§Ø«Ø§Ø¡','Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø®Ù…ÙŠØ³','Ø¬Ù…Ø¹Ø©','Ø³Ø¨Øª'];

  const today = new Date();
  const currentDay = today.getDate();
  const currentMonth = today.getMonth();
  const currentYear = today.getFullYear();
  const initialMonthIndex = currentYear === 2025 ? currentMonth : 0;

  const monthsContainer = document.getElementById('monthsContainer');
  // Ù†Ø¸Ù‘Ù Ø§Ù„Ø´Ø±Ø§Ø¦Ø­
  monthsContainer.innerHTML = '';

  // Ø£Ù†Ø´Ø¦ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ Ù…Ù† Ø¬Ø¯ÙŠØ¯
  monthsList.forEach((month, index) => {
    const slide = document.createElement('div');
    slide.className = 'swiper-slide';

    const daysInMonth = new Date(2025, index + 1, 0).getDate();
    const firstDay = new Date(2025, index, 1).getDay(); // 0=Ø§Ù„Ø£Ø­Ø¯

    let calendarGrid = '';
    // ÙØ±Ø§ØºØ§Øª Ù‚Ø¨Ù„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø±
    for (let i = 0; i < firstDay; i++) {
      calendarGrid += `<div class="day empty"></div>`;
    }
    // Ø§Ù„Ø£ÙŠØ§Ù…
    for (let i = 1; i <= daysInMonth; i++) {
      const isToday = (index === currentMonth && currentYear === 2025 && i === currentDay);
      const dateKey = `2025-${String(index + 1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
      calendarGrid += `
        <div class="day${isToday ? ' today' : ''}" data-date="${dateKey}">
          <div class="day-number">${i}</div>
        </div>
      `;
    }

    slide.innerHTML = `
      <div class="month-title">${month}</div>
      <div class="weekday-row">${weekdays.map(w => `<div>${w}</div>`).join('')}</div>
      <div class="calendar-grid">${calendarGrid}</div>
      <div class="month-buttons">
        <button onclick="openDashboard()">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
        <button onclick="openExpenses('${String(index+1).padStart(2,'0')}')">ğŸ’° Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
        <button onclick="generateReport()">ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
      </div>
    `;
    monthsContainer.appendChild(slide);

    // ØªØ­Ù…ÙŠÙ„ Ø­Ø¬ÙˆØ²Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±
    for (let i = 1; i <= daysInMonth; i++) {
      const dateKey = `2025-${String(index + 1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
      db.collection(calendarCol()).doc(dateKey).get().then(doc => {
        if (doc.exists) {
          const dayEl = slide.querySelector(`.day[data-date='${dateKey}']`);
          if (dayEl) renderBookings(dayEl, doc.data());
        }
      });
    }
  });

  // Ø£Ø¹Ø¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø³ÙˆØ§ÙŠØ¨Ø±
  if (swiper && swiper.destroy) {
    swiper.destroy(true, true);
  }
  swiper = new Swiper('.swiper', {
    slidesPerView: 'auto',
    centeredSlides: true,
    spaceBetween: 0,
    loop: true,
    effect: 'slide',
  });
  swiper.slideToLoop(initialMonthIndex, 0);
}


    // Ø²Ø± "Ø§Ù„ÙŠÙˆÙ…"
    document.getElementById('goToToday').addEventListener('click', () => {
      if (swiper) {
        const today = new Date();
        const monthIndex = today.getMonth();
        swiper.slideToLoop(monthIndex, 500);
      }
    });

    // Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    document.getElementById('generateReportBtn').addEventListener('click', async () => {
      const fromDateStr = document.getElementById('reportFromDate').value;
      const toDateStr = document.getElementById('reportToDate').value;
      const reportDiv = document.getElementById('reportContent');

      if (!fromDateStr || !toDateStr) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ®ÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©.');
        return;
      }
      if (fromDateStr > toDateStr) {
        alert('ØªØ§Ø±ÙŠØ® "Ù…Ù†" ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ ØªØ§Ø±ÙŠØ® "Ø¥Ù„Ù‰".');
        return;
      }

      reportDiv.innerHTML = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...';

      try {
        const fromDate = new Date(fromDateStr);
        const toDate = new Date(toDateStr);

        const oneDayMs = 24 * 60 * 60 * 1000;
        const totalDays = Math.floor((toDate - fromDate) / oneDayMs) + 1;

        let bookedDays = 0;
        let depositDays = 0;
        let totalIncome = 0;

        for (let i = 0; i < totalDays; i++) {
          const date = new Date(fromDate.getTime() + i * oneDayMs);
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          const dayKey = `${year}-${month}-${day}`;

          const doc = await db.collection(calendarCol()).doc(dayKey).get();

          if (doc.exists) {
            const data = doc.data();
            ['morning', 'evening', 'fullDay', 'overnight'].forEach(period => {
              if (data[period] && data[period].status) {
                if (data[period].status === 'Ù…Ø­Ø¬ÙˆØ²') {
                  bookedDays++;
                  totalIncome += parseFloat(data[period].amount) || 0;
                } else if (data[period].status === 'Ø¹Ø±Ø¨ÙˆÙ†') {
                  depositDays++;
                  totalIncome += parseFloat(data[period].deposit) || 0;
                }
              }
            });
          }
        }

        function getMonthsBetween(start, end) {
          const months = [];
          let current = new Date(start.getFullYear(), start.getMonth(), 1);
          const last = new Date(end.getFullYear(), end.getMonth(), 1);
          while (current <= last) {
            months.push(String(current.getMonth() + 1).padStart(2, '0'));
            current.setMonth(current.getMonth() + 1);
          }
          return months;
        }

        const monthsInRange = getMonthsBetween(fromDate, toDate);

        let totalExpenses = 0;
        for (const month of monthsInRange) {
          const expId = expensesDocId(month);
          const expensesDoc = await db.collection("expenses").doc(expId).get();
          if (expensesDoc.exists) {
            const items = expensesDoc.data().items || [];
            totalExpenses += items.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0);
          }
        }

        const netProfit = totalIncome - totalExpenses;

        reportDiv.innerHTML = `
          <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©:</strong> ${bookedDays}</p>
          <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø¨Ø¹Ø±Ø¨ÙˆÙ†:</strong> ${depositDays}</p>
          <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„:</strong> ${totalIncome.toFixed(2)} Ø±.Ø¹</p>
          <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:</strong> ${totalExpenses.toFixed(2)} Ø±.Ø¹</p>
          <p><strong>ØµØ§ÙÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</strong> ${netProfit.toFixed(2)} Ø±.Ø¹</p>
        `;

      } catch (error) {
        reportDiv.innerHTML = `<p style="color:red;">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${error.message}</p>`;
      }
    });
function toast(message, type = 'info') {
  const div = document.createElement('div');
  div.textContent = message;
  div.style.position = 'fixed';
  div.style.bottom = '20px';
  div.style.right = '20px';
  div.style.background = type === 'success' ? '#28a745' : (type === 'error' ? '#dc3545' : '#007bff');
  div.style.color = 'white';
  div.style.padding = '10px 20px';
  div.style.borderRadius = '8px';
  div.style.boxShadow = '0 0 10px rgba(0,0,0,0.3)';
  div.style.zIndex = 9999;
  document.body.appendChild(div);

  setTimeout(() => {
    div.remove();
  }, 3000);
}
(async () => {
  const today = new Date();
  const y = today.getFullYear();
  const m = String(today.getMonth() + 1).padStart(2, '0');
  const d = String(today.getDate()).padStart(2, '0');
  const dateKey = `${y}-${m}-${d}`;

  const doc = await db.collection(calendarCol()).doc(dateKey).get();

  if (doc.exists) {
    const data = doc.data();

    const hasBooking = Object.keys(data).some(period => {
      const p = data[period];
      return p.status && p.status !== 'Ù…ØªØ§Ø­';
    });

    if (hasBooking) {
      // Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø©
      alert(`ğŸ“… Ù„Ø¯ÙŠÙƒ Ø­Ø¬Ø² Ø§Ù„ÙŠÙˆÙ… (${dateKey})`);

      // Ø¥Ø´Ø¹Ø§Ø± Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨
      if (Notification.permission !== 'granted') {
        await Notification.requestPermission();
      }
      if (Notification.permission === 'granted') {
        new Notification('ğŸ“… Ù„Ø¯ÙŠÙƒ Ø­Ø¬Ø² Ø§Ù„ÙŠÙˆÙ…!', {
          body: `ØªØ§Ø±ÙŠØ®: ${dateKey}`,
           icon: getLogoUrl()
        });
      }
    }
  }
})();

function scheduleThankYou(booking) {
  const now = new Date();
  const bookingDate = new Date(currentDateKey);
  let exitDate = new Date(bookingDate);

  const period = currentPeriod;
  if (!period || !booking[period]) return;

  if (period === 'morning' || period === 'evening') {
    const timeRange = booking[period].timePeriod || '08:00-14:00';
    const endTime = timeRange.split('-')[1].trim();
    const [endHour, endMinute] = endTime.split(':');
    exitDate.setHours(+endHour, +endMinute, 0, 0);
  } else if (period === 'fullDay') {
    exitDate.setHours(22, 0, 0, 0); // 10 Ù…Ø³Ø§Ø¡
  } else if (period === 'overnight') {
    exitDate.setDate(exitDate.getDate() + 1);
    exitDate.setHours(9, 0, 0, 0); // Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ 9 ØµØ¨Ø§Ø­
  }

  const msUntilExit = exitDate - now;

  if (msUntilExit <= 0) {
    showThankYou(booking[period].guestName);
  } else {
    setTimeout(() => {
      showThankYou(booking[period].guestName);
    }, msUntilExit);
  }
}

function showThankYou(guestName) {
  const modal = document.createElement('div');
  modal.style.position = 'fixed';
  modal.style.top = '0';
  modal.style.left = '0';
  modal.style.width = '100%';
  modal.style.height = '100%';
  modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
  modal.style.display = 'flex';
  modal.style.justifyContent = 'center';
  modal.style.alignItems = 'center';
  modal.style.zIndex = '10000';

  modal.innerHTML = `
    <div style="
      background: white;
      padding: 20px;
      border-radius: 12px;
      max-width: 350px;
      text-align: center;
      font-family: 'Tajawal', sans-serif;
      color: #333;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
    ">
            <img src="${getLogoUrl()}" alt="Ø´Ø¹Ø§Ø±" style="
        width: 100px;
        display: block;
        margin: 0 auto 10px;
      ">
      <h3 style="color:#007bff;">Ø´ÙƒØ±Ù‹Ø§ ${guestName}!</h3>
      <p>Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ Ø¹Ù„Ù‰ Ø²ÙŠØ§Ø±ØªÙƒ.<br>
      Ø³ÙŠØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø´Ø§Ù„ÙŠÙ‡ ÙˆØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ù„Øº Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ Ø²ÙˆØ¯ØªÙ†Ø§ Ø¨Ù‡.</p>
      <button onclick="this.parentElement.parentElement.remove()" style="
        margin-top: 10px;
        padding: 8px 16px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      ">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  `;

  document.body.appendChild(modal);
}

</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>

async function openDashboard() {
  const content = document.getElementById('dashboardContent');

  content.innerHTML = `<p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>`;
  showPopup('dashboardPopup');

  const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0');
  const day = String(today.getDate()).padStart(2, '0');

  const todayKey = `${year}-${month}-${day}`;
  const startMonthKey = `${year}-${month}-01`;
  const endMonthDay = new Date(year, today.getMonth() + 1, 0).getDate();
  const endMonthKey = `${year}-${month}-${String(endMonthDay).padStart(2, '0')}`;

  let todayCount = 0, monthCount = 0, monthIncome = 0;

  const todayDoc = await db.collection(calendarCol()).doc(todayKey).get();
if (todayDoc.exists) {
  const data = todayDoc.data();
    Object.values(data).forEach(period => {
      if (period.status && period.status !== 'Ù…ØªØ§Ø­') todayCount++;
    });
  }

  const snapshot = await db.collection(calendarCol())
    .where(firebase.firestore.FieldPath.documentId(), ">=", startMonthKey)
    .where(firebase.firestore.FieldPath.documentId(), "<=", endMonthKey)
    .get();

snapshot.forEach(doc => {
    const data = doc.data();
    Object.values(data).forEach(period => {
      if (period.status && period.status !== 'Ù…ØªØ§Ø­') {
        monthCount++;
        monthIncome += Number(period.amount) || 0;
      }
    });
});


  const totalDays = endMonthDay * 4;
  const occupancyRate = ((monthCount / totalDays) * 100).toFixed(1);

  content.innerHTML = `
    <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-bottom:20px;">
      <div style="flex:1; min-width:120px; background:#e6f0ff; padding:10px; border-radius:10px;">
        ğŸ“… <div>Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div><strong>${todayCount}</strong>
      </div>
      <div style="flex:1; min-width:120px; background:#e6f0ff; padding:10px; border-radius:10px;">
        ğŸ“† <div>Ø­Ø¬ÙˆØ²Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div><strong>${monthCount}</strong>
      </div>
      <div style="flex:1; min-width:120px; background:#e6f0ff; padding:10px; border-radius:10px;">
        ğŸ’° <div>Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ</div><strong>${monthIncome} Ø±.Ø¹</strong>
      </div>
      <div style="flex:1; min-width:120px; background:#e6f0ff; padding:10px; border-radius:10px;">
        ğŸ–ï¸ <div>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„</div><strong>${occupancyRate}%</strong>
      </div>
    </div>

    <canvas id="myChart" style="max-width:500px;margin:auto;"></canvas>
  `;

  setTimeout(() => {
    const ctx = document.getElementById('myChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'],
        datasets: [{
          label: 'Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±.Ø¹)',
          data: [500, 700, 800, 600, 750, 950, 1100, 900, 800, 950, 1000, 1200],
          backgroundColor: '#007bff'
        }]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true }},
        plugins: { legend: { display: false }}
      }
    });
  }, 100);
}
function showNotification(message) {
  const notif = document.getElementById('notifications');
  notif.textContent = message;
  notif.style.display = 'block';
  setTimeout(() => {
    notif.style.display = 'none';
  }, 5000);
}

function createReservation(name, date, time, location) {
  const id = Date.now().toString();

  db.collection("reservations").doc(id).set({
    name: name,
    date: date,
    time: time,
    location: location
  })
  .then(() => {
    const link = `https://santorinichalet.github.io/santorini-calendar/reservation.html?id=${id}`;
    console.log("ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø¬Ø²:", link);
    alert(`âœ… ØªÙ… Ø§Ù„Ø­Ø¬Ø²!\nØ±Ø§Ø¨Ø· Ø§Ù„Ø­Ø¬Ø²: ${link}`);
    navigator.clipboard.writeText(link).then(() => {
      console.log("ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©.");
    });
  })
  .catch(error => {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø²:", error);
  });
}
function closeAllPopups() {
  document.querySelectorAll('.popup').forEach(p => p.style.display = 'none');
}

function showPopup(id) {
  closeAllPopups();
  setTimeout(() => {
    const el = document.getElementById(id);
    if (!el) {
      console.error(`âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù†ØµØ± Ø¨Ø§Ù„Ù…Ø¹Ø±Ù: ${id}`);
      return;
    }
    el.style.display = 'block';
  }, 100);
}

function openExpenses(month) {
  closeAllPopups();
  loadExpenses(month).catch(e => {
    console.error('ğŸ’° Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', e);
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª');
  });
}

function generateReport() {
  closeAllPopups();
  showPopup('reportPopup');
  setTimeout(() => {
    const btn = document.getElementById('generateReportBtn');
    if (btn) btn.click();
    else console.error('âŒ Ø²Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
  }, 200);
}


</script>

<script>
let currentProperty = localStorage.getItem('property') || 'chalet';

function calendarCol() {
  return (currentProperty === 'chalet') ? 'calendar2025' : 'calendar2025_apartment';
}


function expensesDocId(month) {
  return (currentProperty === 'chalet')
    ? `expenses-2025-${month}`              // ÙŠØ¨Ù‚Ù‰ Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙƒÙ…Ø§ Ù‡Ùˆ Ù„Ù„Ø´Ø§Ù„ÙŠÙ‡
    : `expenses-2025-${month}-apartment`;   // Ù†Ø³Ø®Ø© Ù…Ù†ÙØµÙ„Ø© Ù„Ù„Ø´Ù‚Ø©
}


function highlightPropertyButton() {
  document.querySelectorAll('.property-switch .prop-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  if (currentProperty === 'chalet') {
    document.querySelector('.property-switch .prop-btn:nth-child(1)').classList.add('active');
  } else {
    document.querySelector('.property-switch .prop-btn:nth-child(2)').classList.add('active');
  }
}


// ØªØ¨Ø¯ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø¬Ø² Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±
function applyPropertyBookingMode() {
  const periodSelect = document.getElementById('periodSelect');
  const periodLabel = document.querySelector('label[for="periodSelect"]');
  const timePeriodInput = document.getElementById('timePeriod');
  const timePeriodLabel = document.getElementById('timePeriodLabel');

  if (!periodSelect) return;

  if (typeof currentProperty !== 'undefined' && currentProperty === 'apartment') {
    // Ø§Ù„Ø´Ù‚Ø©: ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ ÙÙ‚Ø·
    periodSelect.value = 'fullDay';
    periodSelect.disabled = true;
    if (periodLabel) periodLabel.style.display = 'none';
    if (timePeriodInput) timePeriodInput.style.display = 'none';
    if (timePeriodLabel) timePeriodLabel.style.display = 'none';
    try { currentPeriod = 'fullDay'; } catch(e) {}
  } else {
    // Ø§Ù„Ø´Ø§Ù„ÙŠÙ‡: ÙƒÙ„ Ø§Ù„ÙØªØ±Ø§Øª Ù…ØªØ§Ø­Ø©
    periodSelect.disabled = false;
    if (periodLabel) periodLabel.style.display = '';
    // Ø£Ø¸Ù‡Ø± Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙˆÙ‚Øª Ø­Ø³Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø©
    if (timePeriodInput && timePeriodLabel) {
      const show = (periodSelect.value === 'morning' || periodSelect.value === 'evening');
      timePeriodInput.style.display = show ? 'block' : 'none';
      timePeriodLabel.style.display = show ? 'block' : 'none';
    }
  }
}

function switchProperty(type) {
  if (type === currentProperty) return;
  currentProperty = type;
  localStorage.setItem('property', currentProperty);
  highlightPropertyButton();
  if (typeof buildCalendar === 'function') {
    buildCalendar();
updateLogos();       // ğŸ‘ˆ Ù„ÙƒÙŠ ÙŠØªØ¨Ø¯Ù‘Ù„ Ø§Ù„Ø´Ø¹Ø§Ø± ÙÙˆØ±Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„

  }
}

// Ensure property buttons reflect stored property on load
document.addEventListener('DOMContentLoaded', () => {
  try{applyPropertyBookingMode();}catch(e){}
  highlightPropertyButton();
  buildCalendar();   // ğŸ‘ˆ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø£ÙˆÙ„ÙŠ
});

</script>

</body>
</html>
