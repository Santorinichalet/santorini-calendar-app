


<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªØ·Ø¨ÙŠÙ‚ Ø³Ù†ØªÙˆØ±ÙŠÙ†ÙŠ Ø´Ø§Ù„ÙŠÙ‡</title>

  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">

  <style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
    html, body {
      font-family: 'Tajawal', sans-serif;
      background: #ffffff;
      margin: 0; padding: 0; height: 100%; overflow-x: hidden; color: #333;
    }
    .swiper { width: 100vw; height: 100vh; }
    .swiper-slide {
      width: 80%; max-width: 420px;
      opacity: 0.3; transform: scale(0.9);
      transition: all 0.4s ease;
      box-sizing: border-box;
      padding: 10px;
    }
    .swiper-slide-active {
      opacity: 1; transform: scale(1);
      z-index: 10;
    }
    .month-title {
      font-size: 22px; font-weight: 700; margin: 12px 0 8px;
      color: #024488; text-align: center; width: 100%; display: block;
    }
    .weekday-row {
      display: grid; grid-template-columns: repeat(7, 1fr);
      width: 100%; font-size: 13px; text-align: center;
      color: #666; margin-bottom: 5px;
    }
    .calendar-grid {
      display: grid; grid-template-columns: repeat(7, 1fr);
      gap: 6px; width: 100%;
    }
    .day {
      padding: 6px 0 24px; text-align: center;
      background: #f0f0f0; border-radius: 10px;
      cursor: pointer; font-size: 15px;
      position: relative; overflow: visible;
      transition: background 0.2s ease;
      user-select: none;
    }
.day.empty {
  background: #eaeaea;   /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ ÙˆØ§Ø¶Ø­ */
  border-radius: 10px;
  cursor: default;
  box-shadow: none;
  opacity: 0.6;
  color: transparent;   /* Ø¥Ø®ÙØ§Ø¡ Ø£ÙŠ Ù†Øµ Ø¯Ø§Ø®Ù„ÙŠ */
  border: 1px solid #ddd;
}



    .day-number {
      font-size: 15px; font-weight: normal;
    }
    .booking-line {
      font-size: 12px; margin-top: 2px;
      color: #444; user-select: none;
      text-align: center;
      font-weight: bold;
    }
    .booking-line.red { color: #b22222; } /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ø¯Ø§ÙƒÙ† */
    .booking-line.orange { color: #007bff; }
    .day.today {
      border: 2px solid #007bff;
      font-weight: bold; background: #e6f0ff;
      color: #007bff;
    }
    .day:hover { background: #ddd; }

    /* Popup styles */
    .popup {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #fff; padding: 20px 25px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.15);
      z-index: 9999; display: none;
      width: 90%; max-width: 420px;
      color: #333; box-sizing: border-box;
      max-height: 90vh;
      overflow-y: auto;
    }
    .popup h3 {
      margin-top: 0; font-size: 20px; color: #007bff;
      text-align: center;
    }
    .popup label {
      font-weight: 600; margin-top: 12px;
      display: block; color: #444;
    }
    .popup input[type=text],
    .popup input[type=number],
    .popup textarea,
    .popup select {
      padding: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-family: 'Tajawal', sans-serif;
      font-size: 14px;
      width: 100%;
      display: block;
      margin-top: 4px;
    }
    input[type=checkbox] {
      transform: scale(1.3);
      margin-left: 8px;
      vertical-align: middle;
      cursor: pointer;
    }
    .popup button.action {
      background: #28a745;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      transition: background-color 0.3s ease;
    }
    .popup button.action:hover {
      background: #218838;
    }
    .popup .close-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: none;
      border: none;
      font-size: 30px;
      color: #888;
      cursor: pointer;
      padding: 0;
      line-height: 1;
      width: 30px;
      height: 30px;
      text-align: center;
    }
    .close-btn:hover {
      color: #333;
    }

    /* ØªØ¹Ø¯ÙŠÙ„ Ø²Ø± Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø² Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø¶Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .button-group {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 20px;
    }

    .button-group .action {
      flex: 1;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      cursor: pointer;
      border: none;
      color: white;
      transition: background-color 0.3s ease;
    }

    .button-group .action.secondary {
      background-color: #007bff;
    }

    .button-group .action.secondary:hover {
      background-color: #0056b3;
    }

    .button-group .action:hover {
      background-color: #218838;
    }

    /* Ø²Ø± Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø² Ù…Ø®ÙÙŠ Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ */
    #showBookingCard {
      display: none;
    }

    #goToToday {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 50px;
      font-size: 14px;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .month-buttons {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 20px;
    }

    .month-buttons button {
      background-color: #024488;
      color: white;
      padding: 10px 18px;
      font-size: 15px;
      border: none;
      border-radius: 12px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .month-buttons button:hover {
      transform: scale(1.05);
    }

    /* Expenses list */
    #expenseList {
      margin-top: 12px;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      font-size: 14px;
      background: #fafafa;
    }
    #expenseList div {
      margin-bottom: 6px;
      padding-bottom: 4px;
      border-bottom: 1px solid #ddd;
    }
    .logo-container {
      text-align: center;
      margin: 20px 0;
    }

    .logo-container img {
      width: 160px;
      max-width: 90%;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      transition: transform 0.3s ease;
    }

    .logo-container img:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }
#bookingCardPopup img {
  max-width: 100%;
  width: 120px;
  display: block;
  margin: 0 auto;
}

  </style>
</head>
<body>
<div class="logo-container">
  <img src="https://i.ibb.co/271BVWXd/Santorini-Logo.png" alt="Santorini-Logo" border="0">
</div>


  <div class="swiper">
    <div class="swiper-wrapper" id="monthsContainer"></div>
  </div>

  <button id="goToToday">Ø§Ù„ÙŠÙˆÙ…</button>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø¬Ø² -->
  <div class="popup" id="bookingPopup">
    <button class="close-btn" onclick="closePopup('bookingPopup')">Ã—</button>
    <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²</h3>
    <label for="periodSelect">Ø§Ù„ÙØªØ±Ø©:</label>
    <select id="periodSelect">
      <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø©</option>
      <option value="morning">ØµØ¨Ø§Ø­</option>
      <option value="evening">Ù…Ø³Ø§Ø¡</option>
      <option value="fullDay">ÙŠÙˆÙ… ÙƒØ§Ù…Ù„</option>
      <option value="overnight">Ù…Ø¨ÙŠØª</option>
    </select>
    <label for="timePeriod" id="timePeriodLabel" style="display:none;">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</label>
    <input type="text" id="timePeriod" placeholder="Ù…Ø«Ø§Ù„: 8-12 Øµ Ø£Ùˆ 4-8 Ù…" style="display:none;" />
    <label for="status">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø²:</label>
    <select id="status">
      <option value="">Ø§Ø®ØªØ±</option>
      <option value="Ù…Ø­Ø¬ÙˆØ²">Ù…Ø­Ø¬ÙˆØ²</option>
      <option value="Ø¹Ø±Ø¨ÙˆÙ†">Ø¹Ø±Ø¨ÙˆÙ†</option>
      <option value="Ù…ØªØ§Ø­">Ù…ØªØ§Ø­</option>
    </select>
    <label for="amount">Ø§Ù„Ø³Ø¹Ø±:</label>
    <input id="amount" type="number" placeholder="Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ" />
    <div class="deposit-group" id="depositGroup" style="display:none;">
      <label for="deposit" style="font-weight: bold; color: #c00;">Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†:</label>
      <input type="number" id="deposit" placeholder="Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ" style="width: 80px; margin-left: 6px;" />
      <span id="remaining" style="margin-left: 10px; font-weight: bold;"></span>
    </div>
    <hr style="margin: 20px 0;" />
    <label for="guestName">Ø§Ø³Ù… Ø§Ù„Ø¶ÙŠÙ:</label>
    <input type="text" id="guestName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¶ÙŠÙ" />
    <label for="guestPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
    <input type="text" id="guestPhone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" />
    <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
    <textarea id="notes" rows="2" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©"></textarea>
    <div class="button-group">
      <button id="saveBooking" class="action">ğŸ’¾ Ø­ÙØ¸</button>
      <button id="showBookingCard" class="action secondary">ğŸƒ Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø²</button>
    </div>
  </div>

  <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø² -->
  <div class="popup" id="bookingCardPopup" style="max-width: 350px;">
    <button class="close-btn" onclick="closePopup('bookingCardPopup')">Ã—</button>
    <img src="https://i.ibb.co/271BVWXd/Santorini-Logo.png" alt="Santorini-Logo" border="0">
    <h3 style="text-align:center;">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø²</h3>
    <div id="bookingCardContent" style="font-size: 14px; line-height: 1.4; direction: rtl;"></div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
  <div class="popup" id="expensesPopup" style="max-width: 350px;">
    <button class="close-btn" onclick="closePopup('expensesPopup')">Ã—</button>
    <h3>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
    <label for="expenseTypeSelect">Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ:</label>
    <select id="expenseTypeSelect" style="width: 100%; padding: 6px; font-size: 14px;">
      <option value="" disabled selected>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</option>
      <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
      <option value="Ù…Ø§Ø¡">Ù…Ø§Ø¡</option>
      <option value="Ø±ÙˆØ§ØªØ¨">Ø±ÙˆØ§ØªØ¨</option>
      <option value="ØªÙ†Ø¸ÙŠÙ">ØªÙ†Ø¸ÙŠÙ</option>
      <option value="Ø§Ù†ØªØ±Ù†Øª">Ø§Ù†ØªØ±Ù†Øª</option>
      <option value="ØµÙŠØ§Ù†Ø©">ØµÙŠØ§Ù†Ø©</option>
      <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
    </select>
    <input type="text" id="expenseTypeInput" placeholder="Ø£Ø¯Ø®Ù„ Ù†ÙˆØ¹ Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯" style="margin-top: 10px; display:none; width: 100%; padding: 6px; font-size: 14px;" />
    <label for="expenseAmount">Ø§Ù„Ù…Ø¨Ù„Øº:</label>
    <input type="number" id="expenseAmount" placeholder="Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ" />
    <div style="display: flex; justify-content: space-between; gap: 10px;">
      <button id="saveExpense" class="action" style="width: 48%;">Ø­ÙØ¸</button>
      <button id="deleteExpense" class="action" style="width: 48%; background: #dc3545;">Ø­Ø°Ù</button>
    </div>
    <div id="expenseList"></div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
  <div class="popup" id="reportPopup" style="max-width: 400px;">
    <button class="close-btn" onclick="closePopup('reportPopup')">Ã—</button>
    <h3>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù†Ø·Ø§Ù‚</h3>
    <label for="reportFromDate">Ù…Ù†:</label>
    <input type="date" id="reportFromDate" value="2025-01-01" max="2025-12-31" />
    <label for="reportToDate" style="margin-top: 12px;">Ø¥Ù„Ù‰:</label>
    <input type="date" id="reportToDate" value="2025-01-31" max="2025-12-31" />
    <button id="generateReportBtn" class="action" style="width: 100%; margin-top: 15px;">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    <div id="reportContent" style="font-size: 14px; line-height: 1.5; min-height: 120px; margin-top: 12px;"></div>
  </div>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').then(() => {
    console.log('Service Worker Registered');
  });
}
</script>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAs1Qz1_8Bge6LvIZ61CsjQV4P8RSa8t4A",
  authDomain: "santorini-chalet.firebaseapp.com",
  projectId: "santorini-chalet",
  storageBucket: "santorini-chalet.firebasestorage.app",
  messagingSenderId: "280049242908",
  appId: "1:280049242908:web:2e6e7d9d88506c764760d9",
  measurementId: "G-D8THYXGFSN"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
async function loadMonthBookings(monthIndex) {
  const year = 2025;
  const monthStr = String(monthIndex + 1).padStart(2, '0');
  const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();

  const startKey = `${year}-${monthStr}-01`;
  const endKey   = `${year}-${monthStr}-${String(daysInMonth).padStart(2, '0')}`;

  const bookings = {};

  const snapshot = await db.collection("calendar2025")
    .where(firebase.firestore.FieldPath.documentId(), ">=", startKey)
    .where(firebase.firestore.FieldPath.documentId(), "<=", endKey)
    .get();

  snapshot.forEach(doc => {
    bookings[doc.id] = doc.data();
  });

  renderMonth(monthIndex, bookings);
}

    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
    let currentPeriod = null;
    let currentDateKey = null;
    let currentBookingData = null;
    let currentExpenseDocId = null;
    let expensesList = [];
    let expenseTypes = ['ÙƒÙ‡Ø±Ø¨Ø§Ø¡','Ù…Ø§Ø¡','Ø±ÙˆØ§ØªØ¨','ØªÙ†Ø¸ÙŠÙ','Ø§Ù†ØªØ±Ù†Øª','ØµÙŠØ§Ù†Ø©','Ø£Ø®Ø±Ù‰'];


    // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†
    function toggleDepositGroup(show) {
      const group = document.getElementById('depositGroup');
      group.style.display = show ? 'flex' : 'none';
      if (!show) {
        document.getElementById('deposit').value = '';
        document.getElementById('remaining').textContent = '';
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ø¹Ø±Ø¨ÙˆÙ†
    function updateRemaining() {
      const amount = parseFloat(document.getElementById('amount').value) || 0;
      const deposit = parseFloat(document.getElementById('deposit').value) || 0;
      const remaining = amount - deposit;
      document.getElementById('remaining').textContent = remaining > 0 ? `Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining}` : '';
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙÙŠ Ø§Ù„ÙŠÙˆÙ…
    function renderBookings(dayEl, data) {
      dayEl.querySelectorAll('.booking-line').forEach(el => el.remove());
      if (!data) return;

      ['morning', 'evening', 'fullDay', 'overnight'].forEach(period => {
        if (data[period] && data[period].status && data[period].status.trim() !== 'Ù…ØªØ§Ø­') {
          const div = document.createElement('div');
          div.className = 'booking-line ' + (data[period].status === 'Ù…Ø­Ø¬ÙˆØ²' ? 'red' : 'orange');
          let text = '';
          switch (period) {
case 'morning': text = data[period].timePeriod ? `${data[period].timePeriod}` : ''; break;
case 'evening': text = data[period].timePeriod ? `${data[period].timePeriod}` : ''; break;

            case 'fullDay': text = 'ÙƒØ§Ù…Ù„'; break;
            case 'overnight': text = 'Ù…Ø¨ÙŠØª'; break;
          }
          div.textContent = text;
          dayEl.appendChild(div);
        }
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
    function renderExpenses() {
      const expenseListDiv = document.getElementById('expenseList');
      expenseListDiv.innerHTML = '';
      let total = 0;

      expensesList.forEach(exp => {
        total += parseFloat(exp.amount);
        const div = document.createElement('div');
        div.textContent = `${exp.type} : ${exp.amount} Ø±.Ø¹`;
        expenseListDiv.appendChild(div);
      });

      // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
      const totalDiv = document.createElement('div');
      totalDiv.style.fontWeight = 'bold';
      totalDiv.style.marginTop = '10px';
      totalDiv.textContent = `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total.toFixed(2)} Ø±.Ø¹`;
      expenseListDiv.appendChild(totalDiv);
    }

    // Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙÙŠ ÙØ§ÙŠØ±Ø³ØªÙˆØ±
    function saveExpenses() {
      if (!currentExpenseDocId) return;
      db.collection("expenses").doc(currentExpenseDocId).set({ items: expensesList })
        .then(() => renderExpenses())
        .catch(e => alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ' + e.message));
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙˆÙ†ÙˆØ¹ÙŠØ§ØªÙ‡Ø§
    async function loadExpenses(month) {
      currentExpenseDocId = `expenses-2025-${month}`;
      expensesList = [];
      document.getElementById('expenseList').innerHTML = '';
      document.getElementById('expenseTypeInput').style.display = 'none';
      document.getElementById('expenseTypeSelect').style.display = 'block';

      // ØªØ­Ù…ÙŠÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© (Ø¯Ù…Ø¬ Ø£Ù†ÙˆØ§Ø¹ Ø«Ø§Ø¨ØªØ© Ù…Ø¹ Ø§Ù„ØªÙŠ ÙÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª)
      const allTypes = [...new Set([...expenseTypes])];

      // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ù…Ù† ÙØ§ÙŠØ±Ø³ØªÙˆØ±
      try {
        const doc = await db.collection("expenses").doc(currentExpenseDocId).get();
        if (doc.exists) {
          expensesList = doc.data().items || [];
          expensesList.forEach(exp => {
            if (!allTypes.includes(exp.type)) allTypes.push(exp.type);
          });
        }
      } catch(e) {
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ' + e.message);
      }

      // Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¨Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
      const select = document.getElementById('expenseTypeSelect');
      select.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</option>';
      allTypes.forEach(type => {
        const opt = document.createElement('option');
        opt.value = type;
        opt.textContent = type;
        select.appendChild(opt);
      });

      renderExpenses();
      showPopup('expensesPopup');
    }

    // Ø­Ø¯Ø« ØªØºÙŠÙŠØ± Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ (Ø¥Ø¸Ù‡Ø§Ø± Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ø§Ø®ØªØ±Øª "Ø£Ø®Ø±Ù‰")
    document.getElementById('expenseTypeSelect').addEventListener('change', (e) => {
      if (e.target.value === 'Ø£Ø®Ø±Ù‰') {
        document.getElementById('expenseTypeInput').style.display = 'block';
        document.getElementById('expenseTypeInput').value = '';
        e.target.style.display = 'none';
      }
    });

document.getElementById('saveExpense').addEventListener('click', () => {
  let type = document.getElementById('expenseTypeSelect').value;
  if (!type) {
    type = document.getElementById('expenseTypeInput').value.trim();
    if (!type) {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ');
      return;
    }
  } else if (type === 'Ø£Ø®Ø±Ù‰') {
    // Ø®Ø° Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¯Ø®Ù„ Ø¨Ø¯Ù„ "Ø£Ø®Ø±Ù‰"
    type = document.getElementById('expenseTypeInput').value.trim();
    if (!type) {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ');
      return;
    }
  }
  
  const amount = parseFloat(document.getElementById('expenseAmount').value);
  if (isNaN(amount) || amount <= 0) {
    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ§Ù„Ø­');
    return;
  }

  // ØªØ­Ø¯ÙŠØ« Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ±ÙˆÙ
  const existingIndex = expensesList.findIndex(exp => exp.type === type);
  if (existingIndex !== -1) {
    expensesList[existingIndex].amount += amount;
  } else {
    expensesList.push({ type, amount });
  }

  if (!expenseTypes.includes(type)) expenseTypes.push(type);

  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
  document.getElementById('expenseAmount').value = '';
  document.getElementById('expenseTypeInput').style.display = 'none';
  document.getElementById('expenseTypeInput').value = '';
  document.getElementById('expenseTypeSelect').style.display = 'block';
  document.getElementById('expenseTypeSelect').value = '';

  saveExpenses();
});

document.getElementById('deleteExpense').addEventListener('click', () => {
  let type = document.getElementById('expenseTypeSelect').value;
  
  if (!type || type === 'Ø£Ø®Ø±Ù‰') {
    type = document.getElementById('expenseTypeInput').value.trim();
    if (!type) {
      alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ');
      return;
    }
  }

  const amount = parseFloat(document.getElementById('expenseAmount').value);
  if (isNaN(amount) || amount <= 0) {
    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ§Ù„Ø­');
    return;
  }

  const existingIndex = expensesList.findIndex(exp => exp.type === type);
  if (existingIndex !== -1) {
    expensesList[existingIndex].amount -= amount;
    if (expensesList[existingIndex].amount <= 0) {
      expensesList.splice(existingIndex, 1);
      const typeStillExists = expensesList.some(exp => exp.type === type);
      if (!typeStillExists) {
        expenseTypes = expenseTypes.filter(t => t !== type);
      }
    }
    saveExpenses();
  } else {
    alert('Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
  }

  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
  document.getElementById('expenseAmount').value = '';
  document.getElementById('expenseTypeInput').style.display = 'none';
  document.getElementById('expenseTypeInput').value = '';
  document.getElementById('expenseTypeSelect').style.display = 'block';
  document.getElementById('expenseTypeSelect').value = '';
});


    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ù…Ù† Ø²Ø± Ø§Ù„Ø´Ù‡Ø±
    function openExpenses(month) {
      loadExpenses(month);
    }

    // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø©
    function showPopup(id) {
      document.getElementById(id).style.display = 'block';
    }
    function closePopup(id) {
      document.getElementById(id).style.display = 'none';
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ø¹Ø±Ø¨ÙˆÙ†
    document.getElementById('amount').addEventListener('input', updateRemaining);
    document.getElementById('deposit').addEventListener('input', updateRemaining);

    // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø² (Ø¹Ø±Ø¶ Ø­Ù‚Ù„ Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ† Ø¥Ø°Ø§ Ø¹Ø±Ø¨ÙˆÙ†)
    document.getElementById('status').addEventListener('change', (e) => {
      toggleDepositGroup(e.target.value === 'Ø¹Ø±Ø¨ÙˆÙ†');
      if (e.target.value === 'Ù…ØªØ§Ø­') {
        document.getElementById('amount').value = '';
        document.getElementById('deposit').value = '';
        document.getElementById('remaining').textContent = '';
        document.getElementById('guestName').value = '';
        document.getElementById('guestPhone').value = '';
        document.getElementById('notes').value = '';
      }
    });

    // Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø©
    const periodSelect = document.getElementById('periodSelect');
    const timePeriodInput = document.getElementById('timePeriod');
    const timePeriodLabel = document.getElementById('timePeriodLabel');

    periodSelect.addEventListener('change', (e) => {
      currentPeriod = e.target.value;

      if (!currentPeriod) {
        clearBookingFields();
        return;
      }

      const periodData = (currentBookingData && currentBookingData[currentPeriod]) ? currentBookingData[currentPeriod] : null;

      if (!periodData) {
        clearBookingFields(false);
      } else {
        document.getElementById('status').value = periodData.status || '';
        document.getElementById('amount').value = periodData.amount || '';
        document.getElementById('deposit').value = periodData.deposit || '';
        updateRemaining();
        document.getElementById('guestName').value = periodData.guestName || '';
        document.getElementById('guestPhone').value = periodData.guestPhone || '';
        document.getElementById('notes').value = periodData.notes || '';
      }

      if (currentPeriod === 'morning' || currentPeriod === 'evening') {
        timePeriodInput.value = periodData ? (periodData.timePeriod || '') : '';
        timePeriodInput.style.display = 'block';
        timePeriodLabel.style.display = 'block';
      } else {
        timePeriodInput.value = '';
        timePeriodInput.style.display = 'none';
        timePeriodLabel.style.display = 'none';
      }

      toggleDepositGroup(periodData && periodData.status === 'Ø¹Ø±Ø¨ÙˆÙ†');

      if (periodData && (periodData.status === 'Ù…Ø­Ø¬ÙˆØ²' || periodData.status === 'Ø¹Ø±Ø¨ÙˆÙ†')) {
        document.getElementById('showBookingCard').style.display = 'block';
      } else {
        document.getElementById('showBookingCard').style.display = 'none';
      }
    });

    function clearBookingFields(clearAll = true) {
      if (clearAll) {
        document.getElementById('status').value = '';
        document.getElementById('amount').value = '';
        document.getElementById('deposit').value = '';
        document.getElementById('remaining').textContent = '';
        document.getElementById('guestName').value = '';
        document.getElementById('guestPhone').value = '';
        document.getElementById('notes').value = '';
      }
      timePeriodInput.value = '';
      timePeriodInput.style.display = (currentPeriod === 'morning' || currentPeriod === 'evening') ? 'block' : 'none';
      timePeriodLabel.style.display = (currentPeriod === 'morning' || currentPeriod === 'evening') ? 'block' : 'none';
      toggleDepositGroup(false);
      document.getElementById('showBookingCard').style.display = 'none';
    }

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ÙŠÙˆÙ… ÙÙŠ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ù„ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø¬Ø²
    document.addEventListener('click', (e) => {
      const dayEl = e.target.classList.contains('day') ? e.target : e.target.closest('.day');
      if (!dayEl) return;

      currentDateKey = dayEl.getAttribute('data-date');
      currentBookingData = null;
      currentPeriod = null;

      showPopup('bookingPopup');
      document.getElementById('bookingPopup').setAttribute('data-date', currentDateKey);

      periodSelect.value = '';
      clearBookingFields();

      // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø² Ù„Ù„ÙŠÙˆÙ… Ù…Ù† Firebase
      db.collection("calendar2025").doc(currentDateKey).get().then(doc => {
        if (doc.exists) {
          currentBookingData = doc.data();
        } else {
          currentBookingData = {};
        }
      });
    });

    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬Ø² ÙÙŠ Firestore
document.getElementById('saveBooking').addEventListener('click', async () => {
  if (!currentDateKey) {
    alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠÙˆÙ…!');
    return;
  }
  if (!currentPeriod) {
    alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø©!');
    return;
  }

  const status = document.getElementById('status').value;
  if (!status) {
    alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø²!');
    return;
  }

  if (status === 'Ù…ØªØ§Ø­') {
    const confirmDelete = confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©ØŸ');
    if (!confirmDelete) return;

    try {
      const docRef = db.collection("calendar2025").doc(currentDateKey);
      // Ø§Ø­Ø°Ù Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
      await docRef.update({ [currentPeriod]: firebase.firestore.FieldValue.delete() });
      toast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­', 'success');
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
      const dayEl = document.querySelector(`.day[data-date='${currentDateKey}']`);
      const updatedDoc = await docRef.get();
      const newData = updatedDoc.exists ? updatedDoc.data() : {};
      if (dayEl) renderBookings(dayEl, newData);
      // Ø¥Ø®ÙØ§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø²
      document.getElementById('showBookingCard').style.display = 'none';
      currentBookingData = newData;
      closePopup('bookingPopup');
    } catch (e) {
      toast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²', 'error');
      console.error(e);
    }
    return;

    try {
      const docRef = db.collection("calendar2025").doc(currentDateKey);

      await docRef.update({
        [currentPeriod]: firebase.firestore.FieldValue.delete()
      });

      alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­');
      currentBookingData = null;

      const dayEl = document.querySelector(`.day[data-date='${currentDateKey}']`);
      if (dayEl) renderBookings(dayEl, {});

      document.getElementById('showBookingCard').style.display = 'none';
      closePopup('bookingPopup');
    } catch (e) {
      alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²');
      console.error(e);
    }
    return;
  }

  // Ø¨Ø§Ù‚ÙŠ Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø¹Ø§Ø¯ÙŠ
  const amount = parseFloat(document.getElementById('amount').value) || 0;
  if ((status === 'Ù…Ø­Ø¬ÙˆØ²' || status === 'Ø¹Ø±Ø¨ÙˆÙ†') && amount <= 0) {
    alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­!');
    return;
  }

  const periodData = {
    status,
    amount,
    deposit: status === 'Ø¹Ø±Ø¨ÙˆÙ†' ? (parseFloat(document.getElementById('deposit').value) || 0) : 0,
    guestName: document.getElementById('guestName').value.trim(),
    guestPhone: document.getElementById('guestPhone').value.trim(),
    notes: document.getElementById('notes').value.trim(),
    timePeriod: (currentPeriod === 'morning' || currentPeriod === 'evening') ? timePeriodInput.value.trim() : ''
  };

  const updatedData = {...(currentBookingData || {})};
  updatedData[currentPeriod] = periodData;

  try {
    await db.collection("calendar2025").doc(currentDateKey).set(updatedData);
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
    currentBookingData = updatedData;

    const dayEl = document.querySelector(`.day[data-date='${currentDateKey}']`);
    if (dayEl) renderBookings(dayEl, currentBookingData);

    document.getElementById('showBookingCard').style.display = 'block';
  } catch (e) {
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸');
    console.error(e);
  }
});


    // Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø²
    function showBookingCard() {
      if (!currentPeriod || !currentBookingData || !currentBookingData[currentPeriod]) return;

      const data = currentBookingData[currentPeriod];
      const cardContent = document.getElementById('bookingCardContent');
      const periodNames = {morning: 'ØµØ¨Ø§Ø­', evening: 'Ù…Ø³Ø§Ø¡', fullDay: 'ÙŠÙˆÙ… ÙƒØ§Ù…Ù„', overnight: 'Ù…Ø¨ÙŠØª'};

      cardContent.innerHTML = `
        <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø²:</strong> ${data.status}</p>
        <p><strong>Ø§Ù„ÙØªØ±Ø©:</strong> ${periodNames[currentPeriod]}</p>
        <p><strong>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</strong> ${data.timePeriod || 'Ù„Ø§ ØªÙˆØ¬Ø¯'}</p>
        <p><strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${data.amount} Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ</p>
        ${data.status === 'Ø¹Ø±Ø¨ÙˆÙ†' ? `<p><strong>Ø§Ù„Ø¹Ø±Ø¨ÙˆÙ†:</strong> ${data.deposit} Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ</p>` : ''}
        <p><strong>Ø§Ø³Ù… Ø§Ù„Ø¶ÙŠÙ:</strong> ${data.guestName}</p>
        <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${data.guestPhone}</p>
        <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${data.notes || 'Ù„Ø§ ØªÙˆØ¬Ø¯'}</p>
      `;

      showPopup('bookingCardPopup');
    }

    // Ø²Ø± Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø¬Ø²
    document.getElementById('showBookingCard').addEventListener('click', showBookingCard);

    // ØªÙ‡ÙŠØ¦Ø© swiper Ù„Ù„Ø£Ø´Ù‡Ø±
    let swiper = null;
    document.addEventListener('DOMContentLoaded', () => {
      const monthsList = ['ÙŠÙ†Ø§ÙŠØ± 2025','ÙØ¨Ø±Ø§ÙŠØ± 2025','Ù…Ø§Ø±Ø³ 2025','Ø£Ø¨Ø±ÙŠÙ„ 2025','Ù…Ø§ÙŠÙˆ 2025','ÙŠÙˆÙ†ÙŠÙˆ 2025','ÙŠÙˆÙ„ÙŠÙˆ 2025','Ø£ØºØ³Ø·Ø³ 2025','Ø³Ø¨ØªÙ…Ø¨Ø± 2025','Ø£ÙƒØªÙˆØ¨Ø± 2025','Ù†ÙˆÙÙ…Ø¨Ø± 2025','Ø¯ÙŠØ³Ù…Ø¨Ø± 2025'];
      const weekdays = ['Ø£Ø­Ø¯','Ø¥Ø«Ù†ÙŠÙ†','Ø«Ù„Ø§Ø«Ø§Ø¡','Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø®Ù…ÙŠØ³','Ø¬Ù…Ø¹Ø©','Ø³Ø¨Øª'];
      const today = new Date();
      const currentDay = today.getDate();
      const currentMonth = today.getMonth();
      const currentYear = today.getFullYear();
      const initialMonthIndex = currentYear === 2025 ? currentMonth : 0;
      const monthsContainer = document.getElementById('monthsContainer');

      monthsList.forEach((month, index) => {
        const slide = document.createElement('div');
        slide.className = 'swiper-slide';

        const daysInMonth = new Date(2025, index + 1, 0).getDate();
const firstDay = new Date(2025, index, 1).getDay(); // 0 = Ø§Ù„Ø£Ø­Ø¯, 1 = Ø§Ù„Ø§Ø«Ù†ÙŠÙ†â€¦

let calendarGrid = '';

// Ø£Ø¶Ù Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ÙØ§Ø±ØºØ© Ù‚Ø¨Ù„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø±
for (let i = 0; i < firstDay; i++) {
  calendarGrid += `<div class='day empty'></div>`;
}

// Ø£Ø¶Ù Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ÙØ¹Ù„ÙŠØ©
for (let i = 1; i <= daysInMonth; i++) {
  const isToday = (index === currentMonth && currentYear === 2025 && i === currentDay);
  const dateKey = `2025-${String(index + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
  calendarGrid += `
    <div class='day${isToday ? " today" : ""}' data-date='${dateKey}'>
      <div class="day-number">${i}</div>
    </div>
  `;
}


        slide.innerHTML = `
          <div class="month-title">${month}</div>
          <div class="weekday-row">${weekdays.map(w => `<div>${w}</div>`).join('')}</div>
          <div class="calendar-grid">${calendarGrid}</div>
          <div class="month-buttons">
            <button onclick="openExpenses('${String(index+1).padStart(2,'0')}')">ğŸ’° Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
            <button onclick="showPopup('reportPopup')">ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
          </div>`;

        monthsContainer.appendChild(slide);

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù„Ù„Ø£ÙŠØ§Ù… Ù…Ù† ÙØ§ÙŠØ±Ø³ØªÙˆØ±
        for (let i = 1; i <= daysInMonth; i++) {
          const dateKey = `2025-${String(index + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
          db.collection("calendar2025").doc(dateKey).get().then(doc => {
            if (doc.exists) {
              const dayEl = slide.querySelector(`.day[data-date='${dateKey}']`);
              if (dayEl) renderBookings(dayEl, doc.data());
            }
          });
        }
      });

      swiper = new Swiper('.swiper', {
        slidesPerView: 'auto',
        centeredSlides: true,
        spaceBetween: 0,
        loop: true,
        effect: 'slide',
      });
      swiper.slideToLoop(initialMonthIndex, 0);
    });

    // Ø²Ø± "Ø§Ù„ÙŠÙˆÙ…"
    document.getElementById('goToToday').addEventListener('click', () => {
      if (swiper) {
        const today = new Date();
        const monthIndex = today.getMonth();
        swiper.slideToLoop(monthIndex, 500);
      }
    });

    // Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    document.getElementById('generateReportBtn').addEventListener('click', async () => {
      const fromDateStr = document.getElementById('reportFromDate').value;
      const toDateStr = document.getElementById('reportToDate').value;
      const reportDiv = document.getElementById('reportContent');

      if (!fromDateStr || !toDateStr) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ®ÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©.');
        return;
      }
      if (fromDateStr > toDateStr) {
        alert('ØªØ§Ø±ÙŠØ® "Ù…Ù†" ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ ØªØ§Ø±ÙŠØ® "Ø¥Ù„Ù‰".');
        return;
      }

      reportDiv.innerHTML = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...';

      try {
        const fromDate = new Date(fromDateStr);
        const toDate = new Date(toDateStr);

        const oneDayMs = 24 * 60 * 60 * 1000;
        const totalDays = Math.floor((toDate - fromDate) / oneDayMs) + 1;

        let bookedDays = 0;
        let depositDays = 0;
        let totalIncome = 0;

        for (let i = 0; i < totalDays; i++) {
          const date = new Date(fromDate.getTime() + i * oneDayMs);
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          const dayKey = `${year}-${month}-${day}`;

          const doc = await db.collection("calendar2025").doc(dayKey).get();
          if (doc.exists) {
            const data = doc.data();
            ['morning', 'evening', 'fullDay', 'overnight'].forEach(period => {
              if (data[period] && data[period].status) {
                if (data[period].status === 'Ù…Ø­Ø¬ÙˆØ²') {
                  bookedDays++;
                  totalIncome += parseFloat(data[period].amount) || 0;
                } else if (data[period].status === 'Ø¹Ø±Ø¨ÙˆÙ†') {
                  depositDays++;
                  totalIncome += parseFloat(data[period].deposit) || 0;
                }
              }
            });
          }
        }

        function getMonthsBetween(start, end) {
          const months = [];
          let current = new Date(start.getFullYear(), start.getMonth(), 1);
          const last = new Date(end.getFullYear(), end.getMonth(), 1);
          while (current <= last) {
            months.push(String(current.getMonth() + 1).padStart(2, '0'));
            current.setMonth(current.getMonth() + 1);
          }
          return months;
        }

        const monthsInRange = getMonthsBetween(fromDate, toDate);

        let totalExpenses = 0;
        for (const month of monthsInRange) {
          const expensesDocId = `expenses-2025-${month}`;
          const expensesDoc = await db.collection("expenses").doc(expensesDocId).get();
          if (expensesDoc.exists) {
            const items = expensesDoc.data().items || [];
            totalExpenses += items.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0);
          }
        }

        const netProfit = totalIncome - totalExpenses;

        reportDiv.innerHTML = `
          <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©:</strong> ${bookedDays}</p>
          <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø¨Ø¹Ø±Ø¨ÙˆÙ†:</strong> ${depositDays}</p>
          <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„:</strong> ${totalIncome.toFixed(2)} Ø±.Ø¹</p>
          <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:</strong> ${totalExpenses.toFixed(2)} Ø±.Ø¹</p>
          <p><strong>ØµØ§ÙÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</strong> ${netProfit.toFixed(2)} Ø±.Ø¹</p>
        `;

      } catch (error) {
        reportDiv.innerHTML = `<p style="color:red;">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${error.message}</p>`;
      }
    });
function toast(message, type = 'info') {
  const div = document.createElement('div');
  div.textContent = message;
  div.style.position = 'fixed';
  div.style.bottom = '20px';
  div.style.right = '20px';
  div.style.background = type === 'success' ? '#28a745' : (type === 'error' ? '#dc3545' : '#007bff');
  div.style.color = 'white';
  div.style.padding = '10px 20px';
  div.style.borderRadius = '8px';
  div.style.boxShadow = '0 0 10px rgba(0,0,0,0.3)';
  div.style.zIndex = 9999;
  document.body.appendChild(div);

  setTimeout(() => {
    div.remove();
  }, 3000);
}
(async () => {
  const today = new Date();
  const y = today.getFullYear();
  const m = String(today.getMonth() + 1).padStart(2, '0');
  const d = String(today.getDate()).padStart(2, '0');
  const dateKey = `${y}-${m}-${d}`;

  const doc = await db.collection('calendar2025').doc(dateKey).get();

  if (doc.exists) {
    const data = doc.data();

    const hasBooking = Object.keys(data).some(period => {
      const p = data[period];
      return p.status && p.status !== 'Ù…ØªØ§Ø­';
    });

    if (hasBooking) {
      // Ø¥Ø´Ø¹Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø©
      alert(`ğŸ“… Ù„Ø¯ÙŠÙƒ Ø­Ø¬Ø² Ø§Ù„ÙŠÙˆÙ… (${dateKey})`);

      // Ø¥Ø´Ø¹Ø§Ø± Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨
      if (Notification.permission !== 'granted') {
        await Notification.requestPermission();
      }
      if (Notification.permission === 'granted') {
        new Notification('ğŸ“… Ù„Ø¯ÙŠÙƒ Ø­Ø¬Ø² Ø§Ù„ÙŠÙˆÙ…!', {
          body: `ØªØ§Ø±ÙŠØ®: ${dateKey}`,
          icon: 'https://i.ibb.co/271BVWXd/Santorini-Logo.png'
        });
      }
    }
  }
})();


  </script>

</body>
</html>
